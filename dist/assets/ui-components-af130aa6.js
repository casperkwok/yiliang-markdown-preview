import{r as e,u as t,j as r,I as a,a as n}from"./react-vendor-b5324e8f.js";import{_ as s}from"./lark-vendor-be110709.js";const i={bitable:null,loaded:!1,loading:!0,error:null};let l=null,o=null;const c=()=>{const[t,r]=e.useState(i);return e.useEffect((()=>{let e=!0;return(async()=>{try{const t=await(async()=>l||o||(o=s((()=>import("./lark-vendor-be110709.js").then((e=>e.i))),[],import.meta.url).then((e=>(l=e.bitable,e.bitable))).finally((()=>{o=null})),o))();e&&r({bitable:t,loaded:!0,loading:!1,error:null})}catch(t){e&&r({bitable:null,loaded:!1,loading:!1,error:t instanceof Error?t:new Error("Failed to load Bitable SDK")})}})(),()=>{e=!1}}),[]),t},d=()=>{const{t:r}=t(),{bitable:a,loaded:n,loading:s,error:i}=c(),[l,o]=e.useState({fieldId:void 0,recordId:void 0,content:"",fieldName:r("controlBar.output")}),[d,u]=e.useState([]),[h,g]=e.useState(-1),m=e.useCallback((async()=>{if(n&&a)try{const e=await a.base.getActiveTable(),t=await e.getActiveView(),r=await t.getVisibleRecordIdList();u(r)}catch(e){}}),[a,n]),b=e.useCallback((e=>{if("string"==typeof e)return e||"*No content*";if(Array.isArray(e))try{return e.map((e=>{if(e&&"object"==typeof e){return e.text||""}return""})).join("")||"*No content*"}catch(t){}if(null!=e)try{if("object"==typeof e)try{return JSON.stringify(e,null,2)||"*No content*"}catch(r){return Object.entries(e).map((([e,t])=>`${e}: ${String(t)}`)).join(", ")||"*Object conversion failed*"}return String(e)||"*No content*"}catch(t){}return"*No content*"}),[]),x=e.useCallback((async(e,t)=>{if(!n||!a)return"*No content*";try{const n=await a.base.getActiveTable(),s=await n.getCellString(e,t);if(null==s)return"*No content*";const i=s.replace(/\[object Object\]/g,"");try{const e=JSON.parse(i);return b(e)}catch(r){return i||"*No content*"}}catch(s){return"*Error: Failed to retrieve content*"}}),[a,n,b]),f=e.useCallback(((e,t)=>{if(!e||!t)return;const r=window.setInterval((()=>{x(e,t).then((e=>{e&&e!==l.content&&o((t=>({...t,content:e})))})).catch((e=>{}))}),500);return()=>{window.clearInterval(r)}}),[x,l.content]),w=e.useCallback((e=>{if(!n||!a)return;const{fieldId:t,recordId:r}=e.data;if(!t||!r)return;(async()=>{try{const e=await a.base.getActiveTable(),n=await e.getFieldById(t),s=await n.getName(),i=await x(t,r);o({fieldId:t,recordId:r,content:i,fieldName:s});const l=d.indexOf(r);g(Math.max(l,-1))}catch(e){}})()}),[a,n,d,x]),v=e.useCallback((async e=>{if(!n||!a||!l.fieldId||0===d.length)return;const t=d.indexOf(l.recordId||"");if(-1===t)return;let r;r="prev"===e?t>0?t-1:d.length-1:t<d.length-1?t+1:0;const s=d[r];if(s)try{const e=await x(l.fieldId,s);o((t=>({...t,recordId:s,content:e}))),g(r)}catch(i){}}),[a,n,l.fieldId,l.recordId,d,x]);return e.useEffect((()=>{if(!n||!a)return;m();const e=a.base.onSelectionChange(w);return()=>{e()}}),[a,n,w,m]),e.useEffect((()=>{if(!(n&&a&&l.fieldId&&l.recordId))return;return f(l.fieldId,l.recordId)}),[n,a,l.fieldId,l.recordId,f]),{selection:l,recordIds:d,currentIndex:h,switchRecord:v,loading:s,error:i}},u=""+new URL("logo-bda5f57b.svg",import.meta.url).href,h=""+new URL("logo_en-7f98eb69.svg",import.meta.url).href,g=()=>{const{t:e}=t();return r.jsx(r.Fragment,{children:r.jsxs("a",{href:"https://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=3cbueaf7-a6b9-44ca-96eb-d490646326c5",target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 bg-indigo-500 text-white font-bold rounded-md hover:bg-indigo-600 transition-colors text-xs flex items-center",children:[r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:[r.jsx("path",{d:"M9 2a2 2 0 00-2 2v8a2 2 0 002 2h6a2 2 0 002-2V6.414A2 2 0 0016.414 5L14 2.586A2 2 0 0012.586 2H9z"}),r.jsx("path",{d:"M3 8a2 2 0 012-2v10h8a2 2 0 01-2 2H5a2 2 0 01-2-2V8z"})]}),e("official.doclink")]})})},m=({recordIdsLength:s,currentIndex:i=-1,onSwitchRecord:l})=>{const{t:o,i18n:c}=t(),{selection:m}=d(),b=e.useMemo((()=>{const e=c.language;return"en"===e||"ja"===e?h:u}),[c.language]),x=0===i,f=i===s-1;return r.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50",children:[r.jsx("nav",{className:"bg-app-card px-4 py-2",children:r.jsxs("div",{className:"container mx-auto flex items-center justify-between",children:[r.jsx("div",{className:"flex items-center space-x-4",children:r.jsx("img",{src:b,alt:"Logo",className:"h-6 w-auto"})}),r.jsx(g,{})]})}),r.jsxs("div",{className:"flex justify-between items-center bg-app-card border-b border-app px-4 py-2",children:[r.jsxs("span",{className:"text-sm text-app opacity-70",children:[o("navbar.current")," ",r.jsx("span",{className:"font-bold text-indigo-600",children:m.fieldName||o("navbar.defaultTitle")}),i>-1&&r.jsxs(r.Fragment,{children:[" - ",o("navbar.number"),r.jsx("span",{className:"font-bold text-indigo-600",children:i+1})," ",o("navbar.row")]})]}),r.jsxs("div",{className:"flex space-x-1",children:[r.jsx("button",{className:`h-5 w-10 ${x?"bg-indigo-300 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-700"} text-white rounded shadow-md hover:shadow-lg active:shadow transform active:translate-y-0.5 transition-all flex items-center justify-center`,onClick:()=>!x&&l("prev"),disabled:x,children:r.jsx(a,{className:"text-lg"})}),r.jsx("button",{className:`h-5 w-10 ${f?"bg-indigo-300 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-700"} text-white rounded shadow-md hover:shadow-lg active:shadow transform active:translate-y-0.5 transition-all flex items-center justify-center`,onClick:()=>!f&&l("next"),disabled:f,children:r.jsx(n,{className:"text-lg"})})]})]})]})},b=({message:e})=>{const{t:a}=t();return r.jsx("div",{className:"h-full flex items-center justify-center bg-app-card rounded-lg shadow-sm",children:r.jsxs("div",{className:"text-center max-w-md p-6",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),r.jsx("h3",{className:"text-lg font-medium text-red-600 mb-2",children:a("error.title")}),r.jsx("p",{className:"text-gray-600 mb-4",children:e||a("error.message")}),r.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:a("error.reload")})]})})},x=()=>r.jsx("div",{className:"h-full bg-app-card rounded-lg shadow-sm animate-pulse",children:r.jsxs("div",{className:"p-6",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded-md w-3/4 mb-6"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/6"})]}),r.jsx("div",{className:"mt-8 p-4 bg-gray-100 rounded-md",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-4/5"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})})]})});export{x as C,b as E,m as N,d as u};
//# sourceMappingURL=ui-components-af130aa6.js.map
